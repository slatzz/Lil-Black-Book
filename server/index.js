/////////////////////////////// CODE BEGINS HERE ///////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////// SET UP ///////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
require ('dotenv').config();
const { sequelize, Queries, Favorites }  = require('./db')
const express = require('express');
const path = require('path'); 
const { Sequelize } = require('sequelize');
const app = express();
const { PORT, API_KEY } = process.env;
// const api = 'https://api.yelp.com/v3/businesses/search';
const DIR = path.join(__dirname, '../build');
const HTML_FILE = path.join(DIR, 'index.html');
app.use(express.static(DIR));
const bodyParser = require('body-parser');
app.use(bodyParser.json());
// app.use(bodyParser.urlencoded({extended:true}));

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////// CRUD ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.get('/', (req, res) => {
    res.sendFile(HTML_FILE);
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// READ //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

// app.post('/dictionary', (req, res) => {
//     const { word } = req.body;
//     Queries.create( { word })
//         .then(word => {
//             console.log("Word added to DB!")
//             res.status(201).send(word)
//         })
//         .catch( err => {
//             console.log('not saving word')
//             res.status(500).send(err)
//         })
// })
app.post('/dictionary', (req, res) => {
    // const {word} = req.body;
    // console.log(req.body.word);
    Queries.findAll({ word: req.body.word })
        .then(results => {
            if(!results.length){
                new Queries(req.body).save()
                console.log('Yes added new word hello')
                .then( newWord => {
                    res.status(200)
                    res.send(newWord);
                })
            } else {
                console.log('word already in database')
                res.status(200).send(word)
            }
        })
        .catch( err => { console.log('Errraaaa', err)})
    })
// Look for the queried word
app.get('/dictionary', (req, res) => {
    Queries.findAll({})
      .then(word => {
        console.log('Found word!')
        res.status(200).send(word);
      })
      .catch(err => { res.status(500).send('Could not find word')})
  });

// // 
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// CREATE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
// app.post('/dictionary', (req, res) => {
//     const { word } = req.body;
//     Queries.create({word})
//     .then( (word) => {
//         res.status(200).send(word)
//     })
//     .catch( err => {
//         res.status(500).send(err);
//     })
// })
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// UPDATE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.put('/dictionary', (req, res) => {
    
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// DELETE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

// app.post('/', (req, res) => {
//     res.status(201)
//     res.send({"name": "Ghost Bros", "specialty": "Daemons"});
// })

////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// PORT //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.listen(PORT, () => {
	console.info(`Da LIL BLACK BOOK is listening on ${PORT}`)
})
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////CODE ENDS HERE /////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////