/////////////////////////////// CODE BEGINS HERE ///////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////// SET UP ///////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
require ('dotenv').config();
const { sequelize, Queries, Favorites }  = require('./db')
const express = require('express');
const path = require('path'); 
const { Sequelize } = require('sequelize');
const app = express();
const { PORT, API_KEY } = process.env;
// const api = 'https://api.yelp.com/v3/businesses/search';
const DIR = path.join(__dirname, '../build');
const HTML_FILE = path.join(DIR, 'index.html');
app.use(express.static(DIR));
const bodyParser = require('body-parser');
app.use(bodyParser.json());
// app.use(bodyParser.urlencoded({extended:true}));

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////// CRUD ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.get('/', (req, res) => {
    res.sendFile(HTML_FILE);
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// READ //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.get('/dictionary', (req, res) => {
    Queries.findAll({})
      .then(word => {
        console.log('Found word!')
        res.status(200).send(word);
      })
      .catch(err => { res.status(500).send('Could not find word')})
  });
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// CREATE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.post('/dictionary', (req, res) => {
    const { word } = req.body;
    Queries.create( { word })
        .then(word => {
            console.log("Word added to DB!")
            res.status(201).send(word)
        })
        .catch( err => {
            console.log('not saving word')
            res.status(500).send(err)
        })
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// UPDATE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.put('/dictionary', (req, res) => {
    let { vote } = req.body;
    Queries.update({ rating: vote},)
    .then(query => {
      if(query){
        query.update(rating)
          .then( () => {
            res.sendStatus(200)
          })
        }
    })
    .catch( err => {
        res.status(500).send(err)
    })
  })
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// DELETE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.delete('/dictionary', (req, res) => {
    const { id } = req.params;
    Queries.findById(id)
        .then(query => {
            if(query){
                query.destroy()
                    .then( () => {
                        res.sendStatus(200)
                    })
                    .catch(err => res.status(500))
            }
        })
})

////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// PORT //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.listen(PORT, () => {
	console.info(`Da LIL BLACK BOOK is listening on ${PORT}`)
})
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////CODE ENDS HERE /////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////