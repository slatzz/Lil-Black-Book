/////////////////////////////// CODE BEGINS HERE ///////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////// SET UP ///////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
require ('dotenv').config();
const { sequelize, Query, Favorites }  = require('./db')
const express = require('express');
const path = require('path'); 
const { Sequelize } = require('sequelize');
const app = express();
const { PORT, API_KEY } = process.env;
const api = 'https://api.yelp.com/v3/businesses/search';
const DIR = path.join(__dirname, '../build');
const HTML_FILE = path.join(DIR, 'index.html');
app.use(express.static(DIR));
const bodyParser = require('body-parser');
app.use(bodyParser.urlencoded({extended:false}));
app.use(bodyParser.json());

////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////// CRUD ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.get('/', (req, res) => {
    res.sendFile(HTML_FILE);
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// READ //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

// Look for the queried word
app.get('/dictionary', (req, res) => {
    Query.findAll({})
      .then(word => {
        res.status(200).send(word);
      })
      .catch(err => { res.status(500).send('Could not find word')})
  });

// // 
app.post('/dictionary', (req, res) => {
    const {word} = req.body;
    Query.findAll({ word: req.body.word })
        .then(results => {
            if(!results){
                new Query({word}).save()
                console.log('Yes added new word hello')
                .then( newword => {
                    res.status(200).send(newword);
                    return;
                })
            } else {
                console.log('word already in database')
                res.status(200).send(word)
            }
        })
        .catch( err => { console.log('Errraaaa', err)})
    })
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// CREATE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.post('/dictionary', (req, res) => {
    const { word } = req.body;
    Query.create({word})
    .then( (word) => {
        res.status(200).send(word)
    })
    .catch( err => {
        res.status(500).send(err);
    })
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// UPDATE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.put('/query', (req, res) => {
    
})
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// DELETE ////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////

// app.post('/', (req, res) => {
//     res.status(201)
//     res.send({"name": "Ghost Bros", "specialty": "Daemons"});
// })

////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// PORT //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
app.listen(PORT, () => {
	console.info(`Dis _ooSPOOKYoo_ app is listening on ${PORT}`)
})
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////CODE ENDS HERE /////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////